(()=>{"use strict";var e={n:t=>{var i=t&&t.__esModule?()=>t.default:()=>t;return e.d(i,{a:i}),i},d:(t,i)=>{for(var r in i)e.o(i,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:i[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.jQuery;var i,r=e.n(t);i=function(e){var t,i=window._TGWCFB_FRONTEND_,o=i.ajaxURL,c=i.nonce,l="".concat(o,"?action=upload_profile_picture&security=").concat(c),n=new FormData,a=r()("#crop_container").attr("src"),p=r()('input[name="profile_picture"]');if(null!=e&&null!==(t=e[0])&&void 0!==t&&null!==(t=t.files)&&void 0!==t&&t[0])n.append("file",e[0].files[0]);else{var f=function(e){var t;t=e.split(",")[0].indexOf("base64")>=0?atob(e.split(",")[1]):decodeURI(e.split(",")[1]);for(var i=e.split(",")[0].split(":")[1].split(";")[0],r=new Uint8Array(t.length),o=0;o<t.length;o++)r[o]=t.charCodeAt(o);return new Blob([r],{type:i})}(a),u=new File([f],"snapshot.jpg");n.append("file",u)}n.append("cropped_image",r()(".cropped_image_size").val()),n.append("valid_extension",p.attr("accept")),p.attr("size")&&n.append("max_uploaded_size",p.attr("size"));var s=e.closest(".tgwcfb-profile-picture-upload-field").find(".tgwcfb-upload-profile-picture"),d=s.text();r().ajax({url:l,data:n,type:"POST",processData:!1,contentType:!1,beforeSend:function(){s.text(_TGWCFB_FRONTEND_.uploading)},complete:function(t){var i=JSON.parse(t.responseText),r=i.success,o=i.data,c=e.closest(".tgwcfb-profile-picture-upload-field");if(r){var l=(null==o?void 0:o.attachmentId)||0,n=(null==o?void 0:o.profilePictureURL)||"";c.find(".profile-picture-preview").attr("src",n),l>0&&c.find(".tgwcfb-profile-picture-input").val(n),c.find(".tgwcfb-remove-profile-picture").show(),c.find(".tgwcfb-upload-profile-picture").hide(),c.find(".tgwcfb-profile-picture-upload-error").remove()}else c.append('<span style="display: block" class="tgwcfb-profile-picture-upload-error">'.concat((null==o?void 0:o.message)||"","</span>"));s.text(d)}})},r()("body").on("change",'.tgwcfb-profile-picture-upload-node input[type="file"]',(function(){var e,t,o,c;if(null!=this&&null!==(e=this.files)&&void 0!==e&&e[0]){var l=new FileReader;l.onload=function(e){r()(".img").attr("src",e.target.result)},l.readAsDataURL(this.files[0]),Swal.fire({title:_TGWCFB_FRONTEND_.cropTitle,html:'<img id="crop_container" src="#" alt="your image" class="img"/><input type="hidden" name="cropped_image" class="cropped_image_size"/>',confirmButtonText:_TGWCFB_FRONTEND_.cropBtn,allowOutsideClick:!1,showCancelButton:!0,cancelButtonText:_TGWCFB_FRONTEND_.cancelBtn,customClass:{container:"tgwcfb-swal2-container"}}),r()(".swal2-cancel").on("click",(function(){r()(".tgwcfb-profile-picture-upload-field").find('input[type="file"]').val("")})),t=r()(this),(c=r()("#crop_container")).Jcrop({aspectRatio:1,onSelect:function(e){o={x:e.x,y:e.y,w:e.w,h:e.h}},setSelect:[100,100,50,50]}),r()(".swal2-confirm").on("click",(function(){var e={x:o.x,y:o.y,w:o.w,h:o.h,holder_width:c.css("width"),holder_height:c.css("height")};r()(".cropped_image_size").val(JSON.stringify(e)),i(t)}))}})),r()(document).on("click",".tgwcfb-upload-profile-picture",(function(e){e.preventDefault(),r()(e.currentTarget).closest(".tgwcfb-profile-picture-upload-field").find('input[type="file"]').trigger("click")})),r()(document).ready((function(){var e=r()("body");if(e.hasClass("logged-in")&&e.hasClass("woocommerce-edit-account")){var t=r()(".tgwcfb-profile-picture-upload-field ");if(null==t||!t.length)return;t.find('[name="profile_picture_url"]').val(t.find(".profile-picture-preview").attr("src")),t.find(".tgwcfb-remove-profile-picture").show().siblings(".tgwcfb-upload-profile-picture").css("margin-right","20px")}})),r()(document).on("click",".tgwcfb-remove-profile-picture",(function(e){e.preventDefault();var t=r()(e.currentTarget),i=t.closest(".tgwcfb-profile-picture-upload-field");i.find(".tgwcfb-profile-picture-input").val(""),i.find('input[type="file"][name="profile_picture"]').val("").off("click"),i.find(".tgwcfb-profile-picture-upload-error").remove(),i.find(".profile-picture-preview").attr("src","https://secure.gravatar.com/avatar/?s=96&d=mm&r=g"),t.hide(),i.find(".tgwcfb-upload-profile-picture").show()}))})();